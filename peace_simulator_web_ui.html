<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïäÔ∏è Interactive Peace Simulator - 1937 ‰∏≠Êó•Âç±Ê©ü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }

        .setup-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .role-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .role-card {
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .role-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .role-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .role-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .role-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .setting-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .setting-group h3 {
            margin-bottom: 15px;
            color: #333;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .mode-toggle {
            display: flex;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .mode-option {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-option.active {
            background: #667eea;
            color: white;
        }

        .start-button {
            width: 100%;
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .simulation-area {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .player-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: bold;
        }

        .metrics-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid #28a745;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .situation-panel {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .situation-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .decision-panel {
            background: #e8f4f8;
            border: 1px solid #bee5eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .decision-title {
            font-weight: bold;
            color: #0c5460;
            margin-bottom: 15px;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .decision-option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .decision-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .decision-option.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .decision-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
            margin-bottom: 15px;
        }

        .submit-decision {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .submit-decision:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .events-log {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .event-item {
            padding: 10px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
        }

        .event-time {
            font-size: 0.8rem;
            color: #666;
        }

        .dev-panel {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            font-family: monospace;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .role-selection {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-panel {
                grid-template-columns: 1fr 1fr;
            }
            
            .decision-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üïäÔ∏è Interactive Peace Simulator</h1>
            <div class="subtitle">1937Âπ¥‰∏≠Êó•Âç±Ê©ü - ‰Ω†ËÉΩÈòªÊ≠¢Êà∞Áà≠ÂóéÔºü</div>
            <p>È´îÈ©óÊ≠∑Âè≤ËΩâÊäòÈªûÔºåÈÅãÁî®Â§ñ‰∫§Êô∫ÊÖßÂåñËß£Âç±Ê©üÔºåÈÅøÂÖçÂÖ®Èù¢Êà∞Áà≠ÁöÑÁàÜÁôº</p>
        </div>

        <!-- Setup Panel -->
        <div class="setup-panel" id="setupPanel">
            <h2 style="margin-bottom: 30px; text-align: center;">üé≠ ÈÅ∏ÊìáÊÇ®ÁöÑËßíËâ≤ËàáË®≠ÂÆö</h2>
            
            <!-- Role Selection -->
            <div class="role-selection">
                <div class="role-card" data-role="emperor">
                    <div class="role-icon">üëë</div>
                    <div class="role-title">Êò≠ÂíåÂ§©Áöá</div>
                    <div class="role-description">
                        Á•ûËÅñ‰∏çÂèØ‰æµÁäØÁöÑÊó•Êú¨Â§©ÁöáÔºåÊìÅÊúâËá≥È´òÁÑ°‰∏äÁöÑÈÅìÂæ∑Â®ÅÊúõ„ÄÇ
                        ÊÇ®ÈúÄË¶ÅÂú®ËªçÈÉ®Â£ìÂäõËàáÂíåÂπ≥ÁêÜÊÉ≥ÈñìÂèñÂæóÂπ≥Ë°°ÔºåÈÅãÁî®Â∏ùÁéãÊ¨äÂ®ÅÈòªÊ≠¢Êà∞Áà≠„ÄÇ
                    </div>
                </div>
                <div class="role-card" data-role="chiang">
                    <div class="role-icon">üá®üá≥</div>
                    <div class="role-title">Ëî£‰∏≠Ê≠£</div>
                    <div class="role-description">
                        ‰∏≠ËèØÊ∞ëÂúãÈ†òË¢ñÔºåÈù¢Ëá®Êó•Êú¨‰æµÁï•Â®ÅËÑÖ„ÄÇ
                        ÊÇ®ÂøÖÈ†àÂú®Á∂≠Ë≠∑ÂúãÂÆ∂‰∏ªÊ¨äËàáÈÅøÂÖçÂÖ®Èù¢Êà∞Áà≠ÈñìÂÅöÂá∫Ëâ±Èõ£ÊäâÊìáÔºå‰øùË≠∑‰∏≠Âúã‰∫∫Ê∞ë„ÄÇ
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>ü§ñ AI Ê®°ÂûãÈÅ∏Êìá</h3>
                    <select id="modelSelect">
                        <option value="gemini/gemini-2.0-flash">Gemini 2 Flash (Êé®Ëñ¶)</option>
                        <option value="groq/meta-llama/llama-4-scout-17b-16e-instruct">Groq Llama 4 Scout </option>
                        <option value="groq/llama-3.1-8b-instant">Groq Llama 3.1 8B (Âø´ÈÄü)</option>
                        <option value="gpt-4">OpenAI GPT-4</option>
                        <option value="claude-3">Anthropic Claude-3</option>
                    </select>
                </div>

                <div class="setting-group">
                    <h3>‚è±Ô∏è ÊúÄÂ§ßÂõûÂêàÊï∏</h3>
                    <input type="number" id="maxTurns" value="15" min="5" max="30">
                </div>
            </div>

            <div class="setting-group">
                <h3>üîç Ê®°Êì¨Ê®°Âºè</h3>
                <div class="mode-toggle">
                    <div class="mode-option active" data-mode="default">
                        <div>üëÅÔ∏è ÈªòË™çÊ®°Âºè</div>
                        <small>ÁúüÂØ¶Ë¶ñËßíÔºåÂè™ÁúãÂà∞ËßíËâ≤ÂèØÁç≤ÂæóÁöÑ‰ø°ÊÅØ</small>
                    </div>
                    <div class="mode-option" data-mode="dev">
                        <div>üîç ÈñãÁôºËÄÖÊ®°Âºè</div>
                        <small>ÂÖ®ÈÄèÊòéÔºåÂèØË¶ãÊâÄÊúâËßíËâ≤ÁöÑÊÉ≥Ê≥ïÂíåË®àÂäÉ</small>
                    </div>
                </div>
            </div>

            <button class="start-button" id="startSimulation" disabled>
                üöÄ ÈñãÂßãÂíåÂπ≥Ê®°Êì¨
            </button>
        </div>

        <!-- Simulation Area -->
        <div class="simulation-area" id="simulationArea">
            <!-- Game Header -->
            <div class="game-header">
                <div class="player-info" id="playerInfo">
                    <div>ËßíËâ≤ÔºöÊú™ÈÅ∏Êìá</div>
                    <div>ÂõûÂêàÔºö0/0</div>
                </div>
                <div class="player-info" id="modeInfo">
                    Ê®°ÂºèÔºöÊú™Ë®≠ÂÆö
                </div>
            </div>

            <!-- Peace Metrics -->
            <div class="metrics-panel" id="metricsPanel">
                <div class="metric-card">
                    <div class="metric-value" id="reputationScore">50</div>
                    <div class="metric-label">ÂúãÈöõËÅ≤Êúõ</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="reputationProgress" style="width: 50%"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="stabilityScore">50</div>
                    <div class="metric-label">ÂÖßÈÉ®Á©©ÂÆö</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="stabilityProgress" style="width: 50%"></div>
                    </div>
                </div>
            </div>

            <!-- Current Situation -->
            <div class="situation-panel" id="situationPanel">
                <div class="situation-title">
                    üö® Áï∂ÂâçÂ±ÄÂã¢
                </div>
                <div id="currentSituation">
                    Ê≠£Âú®Âä†ËºâÊÉÖÊ≥ÅÂàÜÊûê...
                </div>
            </div>

            <!-- Decision Panel -->
            <div class="decision-panel" id="decisionPanel" style="display: none;">
                <div class="decision-title">
                    ü§î ÊÇ®ÁöÑÊ±∫Á≠ñÊôÇÂàª
                </div>
                <div id="decisionDescription">
                    Ë´ãÈÅ∏ÊìáÊÇ®ÁöÑË°åÂãïÊñπÈáù...
                </div>
                
                <div class="decision-options" id="decisionOptions">
                    <div class="decision-option" data-option="diplomatic">
                        <strong>üïäÔ∏è Â§ñ‰∫§ÂÄ°Ë≠∞</strong>
                        <p>ÊèêË≠∞Áõ¥Êé•Ë´áÂà§ÔºåÂ∞ãÊ±ÇÂíåÂπ≥Ëß£Ê±∫ÊñπÊ°à</p>
                    </div>
                    <div class="decision-option" data-option="restraint">
                        <strong>üõ°Ô∏è Ëªç‰∫ãÂÖãÂà∂</strong>
                        <p>‰∏ã‰ª§ÈÅøÂÖçËªç‰∫ãÂçáÁ¥öÔºå‰øùÊåÅÈò≤Á¶¶ÊÖãÂã¢</p>
                    </div>
                    <div class="decision-option" data-option="mediation">
                        <strong>üåê ÂúãÈöõË™øËß£</strong>
                        <p>Â∞ãÊ±ÇÁ¨¨‰∏âÊñπÂúãÈöõÂäõÈáè‰ªãÂÖ•Ë™øÂÅú</p>
                    </div>
                    <div class="decision-option" data-option="unity">
                        <strong>ü§ù ÂÖßÈÉ®ÂúòÁµê</strong>
                        <p>ÂúòÁµêÂúãÂÖßÂêÑÊ¥æÁ≥ªÊîØÊåÅÂíåÂπ≥ÊîøÁ≠ñ</p>
                    </div>
                    <div class="decision-option" data-option="concession">
                        <strong>‚öñÔ∏è Á≠ñÁï•ËÆìÊ≠•</strong>
                        <p>ÊèêÂá∫Â¶•ÂçîÊñπÊ°à‰ª•Èò≤Ê≠¢Êà∞Áà≠ÁàÜÁôº</p>
                    </div>
                    <div class="decision-option" data-option="appeal">
                        <strong>üì¢ ÂÖ¨ÈñãÂëºÁ±≤</strong>
                        <p>ÂêëÂúãÈöõÁ§æÊúÉÁôºË°®ÂíåÂπ≥ËÅ≤Êòé</p>
                    </div>
                </div>

                <textarea class="decision-input" id="decisionInput" 
                          placeholder="Ë´ãË©≥Á¥∞Ë™™ÊòéÊÇ®ÁöÑÊ±∫Á≠ñÁêÜÁî±ÂíåÂÖ∑È´îÂØ¶ÊñΩÊñπÊ°à...&#10;&#10;‰æãÂ¶ÇÔºö&#10;- ÂÖ∑È´îÁöÑË´áÂà§Ê¢ù‰ª∂&#10;- È†êÊúüÁöÑÁµêÊûú&#10;- È¢®Èö™Ë©ï‰º∞&#10;- ÂÇôÈÅ∏ÊñπÊ°à"></textarea>

                <button class="submit-decision" id="submitDecision">
                    ‚úÖ Á¢∫Ë™çÊ±∫Á≠ñ
                </button>
            </div>

            <!-- Events Log -->
            <div class="events-log" id="eventsLog">
                <h3>üìã ‰∫ã‰ª∂Ë®òÈåÑ</h3>
                <div id="eventsList">
                    <div class="event-item">
                        <div class="event-time">1937Âπ¥7Êúà7Êó•</div>
                        <div>ÁõßÊ∫ùÊ©ã‰∫ãËÆäÁàÜÁôºÔºå‰∏≠Êó•ÂÖ©ËªçÁôºÁîüË°ùÁ™Å</div>
                    </div>
                </div>
            </div>

            <!-- Dev Panel (only visible in dev mode) -->
            <div class="dev-panel" id="devPanel" style="display: none;">
                <h3>üîç ÈñãÁôºËÄÖÊ®°Âºè - AI ‰ª£ÁêÜÊÄùÁ∂≠ÈÅéÁ®ã</h3>
                <div id="devOutput">
                    Á≠âÂæÖ AI ‰ª£ÁêÜÂàÜÊûê...
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading" id="loadingState" style="display: none;">
                <div class="spinner"></div>
                <div>AI Ê≠£Âú®ÂàÜÊûêÂ±ÄÂã¢‰∏¶Âà∂ÂÆöÂõûÊáâ...</div>
                <div style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    ÈÄôÂèØËÉΩÈúÄË¶Å‰∏Ä‰∫õÊôÇÈñìÔºåË´ãËÄêÂøÉÁ≠âÂæÖ
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let gameState = {
            selectedRole: null,
            selectedMode: 'default',
            selectedModel: 'groq/llama3-70b-8192',
            maxTurns: 15,
            currentTurn: 0,
            isSimulationRunning: false,
            currentDecision: null,
            metrics: {
                peace: 100,
                diplomacy: 0,
                reputation: 50,
                stability: 50
            }
        };

        // Initialize UI
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            checkAPIConfiguration();
        });

        function initializeEventListeners() {
            // Role selection
            document.querySelectorAll('.role-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectRole(this.dataset.role);
                });
            });

            // Mode selection
            document.querySelectorAll('.mode-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectMode(this.dataset.mode);
                });
            });

            // Settings
            document.getElementById('modelSelect').addEventListener('change', function() {
                gameState.selectedModel = this.value;
            });

            document.getElementById('maxTurns').addEventListener('change', function() {
                gameState.maxTurns = parseInt(this.value);
            });

            // Start simulation
            document.getElementById('startSimulation').addEventListener('click', startSimulation);

            // Decision options
            document.querySelectorAll('.decision-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectDecisionOption(this.dataset.option);
                });
            });

            // Submit decision
            document.getElementById('submitDecision').addEventListener('click', submitDecision);
        }

        function selectRole(role) {
            gameState.selectedRole = role;
            
            // Update UI
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.role === role);
            });

            checkStartConditions();
        }

        function selectMode(mode) {
            gameState.selectedMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.toggle('active', option.dataset.mode === mode);
            });
        }

        function selectDecisionOption(option) {
            gameState.currentDecision = option;
            
            // Update UI
            document.querySelectorAll('.decision-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.option === option);
            });
        }

        function checkStartConditions() {
            const canStart = gameState.selectedRole !== null;
            document.getElementById('startSimulation').disabled = !canStart;
        }

        function checkAPIConfiguration() {
            // In a real implementation, this would check if API keys are configured
            // For demo purposes, we'll assume they're available
            console.log('Checking API configuration...');
        }

        function startSimulation() {
            if (!gameState.selectedRole) {
                alert('Ë´ãÂÖàÈÅ∏ÊìáËßíËâ≤ÔºÅ');
                return;
            }

            gameState.isSimulationRunning = true;
            gameState.currentTurn = 0;

            // Hide setup panel and show simulation
            document.getElementById('setupPanel').style.display = 'none';
            document.getElementById('simulationArea').style.display = 'block';

            // Update player info
            const roleNames = {
                emperor: 'Êò≠ÂíåÂ§©Áöá',
                chiang: 'Ëî£‰∏≠Ê≠£'
            };
            
            const modeNames = {
                default: 'ÈªòË™çÊ®°Âºè',
                dev: 'ÈñãÁôºËÄÖÊ®°Âºè'
            };

            document.getElementById('playerInfo').innerHTML = `
                <div>ËßíËâ≤Ôºö${roleNames[gameState.selectedRole]}</div>
                <div>ÂõûÂêàÔºö${gameState.currentTurn}/${gameState.maxTurns}</div>
            `;
            document.getElementById('modeInfo').textContent = `Ê®°ÂºèÔºö${modeNames[gameState.selectedMode]}`;

            // Show dev panel if in dev mode
            if (gameState.selectedMode === 'dev') {
                document.getElementById('devPanel').style.display = 'block';
            }

            // Start first turn
            startNewTurn();
        }

        function startNewTurn() {
            gameState.currentTurn++;
            
            // Update turn counter
            const roleNames = {
                emperor: 'Êò≠ÂíåÂ§©Áöá',
                chiang: 'Ëî£‰∏≠Ê≠£'
            };
            
            document.getElementById('playerInfo').innerHTML = `
                <div>ËßíËâ≤Ôºö${roleNames[gameState.selectedRole]}</div>
                <div>ÂõûÂêàÔºö${gameState.currentTurn}/${gameState.maxTurns}</div>
            `;

            // Show loading state
            showLoading(true);
            
            // Simulate AI analysis (in real implementation, this would call the backend)
            setTimeout(() => {
                generateSituationUpdate();
                showLoading(false);
                showDecisionPanel();
            }, 3000);
        }

        function generateSituationUpdate() {
            const situations = {
                emperor: [
                    "ËªçÈÉ®Â∞áÈ†òË¶ÅÊ±ÇÊÇ®ÊâπÂáÜÂ∞çËèØÂåóÁöÑÈÄ≤‰∏ÄÊ≠•Ëªç‰∫ãË°åÂãïÔºåËÅ≤Á®±ÈÄôÊòØÁ∂≠Ë≠∑Â∏ùÂúãÂ∞äÂö¥ÁöÑÂøÖË¶ÅÊé™ÊñΩ„ÄÇÂêåÊôÇÔºåÂúãÈöõËßÄÂØüÂÆ∂Ë≠¶ÂëäÊ≠§ËàâÂèØËÉΩÂºïÁôºÂÖ®Èù¢Êà∞Áà≠„ÄÇ",
                    "ÈóúÊù±ËªçÂ†±Âëä‰∏≠ÂúãËªçÈöäÂú®ËèØÂåóÈõÜÁµêÔºåË¶ÅÊ±ÇÈ†êÂÖàÊâπÂáÜËá™Ë°õÂèçÊìä„ÄÇÂ§ñÂãôÁúÅÂª∫Ë≠∞ÈÄèÈÅéÂ§ñ‰∫§ÈÄîÂæëËß£Ê±∫Ôºå‰ΩÜËªçÈÉ®Ë™çÁÇ∫Â§ñ‰∫§ÊâãÊÆµÈÅéÊñºËªüÂº±„ÄÇ",
                    "ÂúãÈöõËÅØÁõüÂëºÁ±≤ÈõôÊñπÂÖãÂà∂ÔºåÁæéÂúãË°®ÈÅîÈóúÂàá„ÄÇËªçÈÉ®Ë™çÁÇ∫ÈÄôÊòØË•øÊñπÂã¢ÂäõÂπ≤Ê∂âÔºå‰ΩÜ‰πüÊúâÈ°ßÂïèÂª∫Ë≠∞ÈÄôÊòØÂ±ïÁèæÊó•Êú¨ÂíåÂπ≥ÊÑèÈ°òÁöÑÊ©üÊúÉ„ÄÇ"
                ],
                chiang: [
                    "Êó•ËªçÂú®ËèØÂåóË™øÂãïÈ†ªÁπÅÔºåÂú∞ÊñπÊåáÊèÆÂÆòË´ãÊ±Ç‰∏≠Â§ÆÊîøÂ∫úÊòéÁ¢∫ÊåáÁ§∫„ÄÇÂÖ±Áî¢Èª®ÊñπÈù¢Ë°®Á§∫È°òÊÑèÊö´ÊôÇÂêà‰ΩúÊäóÊó•Ôºå‰ΩÜÊ¢ù‰ª∂ÊòØÂÅúÊ≠¢ÂâøÂÖ±„ÄÇ",
                    "ÂêÑÂú∞ËªçÈñ•Â∞çÊòØÂê¶ÊäµÊäóÊó•ËªçÊÑèË¶ãÂàÜÊ≠ßÔºåÊúâ‰∫õ‰∏ªÂºµÂ¶•Âçî‰ª•‰øùÂ≠òÂØ¶ÂäõÔºåÊúâ‰∫õË¶ÅÊ±ÇÂ†ÖÊ±∫ÊäµÊäó„ÄÇÂúãÈöõÁ§æÊúÉÁöÑÊîØÊåÅ‰ªçÁÑ∂ÊúâÈôê„ÄÇ",
                    "Êó•Êú¨ÊñπÈù¢ÈáãÂá∫ÂèØËÉΩË´áÂà§ÁöÑ‰ø°ËôüÔºå‰ΩÜÊ¢ù‰ª∂ËãõÂàª„ÄÇÂúãÂÖßËºøË´ñË¶ÅÊ±ÇÂº∑Á°¨ÂõûÊáâÔºå‰ΩÜËªç‰∫ãÂØ¶ÂäõÂ∑ÆË∑ùÊòéÈ°Ø„ÄÇ"
                ]
            };

            const currentSituations = situations[gameState.selectedRole];
            const situationIndex = (gameState.currentTurn - 1) % currentSituations.length;
            
            document.getElementById('currentSituation').textContent = currentSituations[situationIndex];

            // Add event to log
            addEvent(`Á¨¨${gameState.currentTurn}ÂõûÂêà`, currentSituations[situationIndex]);

            // Simulate dev mode AI thoughts
            if (gameState.selectedMode === 'dev') {
                const devThoughts = [
                    "Tosei-ha Agent: ÂàÜÊûêÁï∂ÂâçÂ±ÄÂã¢ÔºåÂª∫Ë≠∞Êé°ÂèñÊº∏ÈÄ≤ÂºèÊéßÂà∂Á≠ñÁï•...",
                    "Chinese Communist Agent: Ë©ï‰º∞Áµ±‰∏ÄÊà∞Á∑öÂèØËÉΩÊÄßÔºåÊ∫ñÂÇôÁæ§ÁúæÂãïÂì°ÊñπÊ°à...",
                    "Zaibatsu Agent: Ë®àÁÆóÊà∞Áà≠Á∂ìÊøüÊî∂ÁõäÔºåË©ï‰º∞ÂúãÈöõÂ∏ÇÂ†¥È¢®Èö™..."
                ];
                document.getElementById('devOutput').innerHTML = devThoughts.map(thought => 
                    `<div style="margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px;">${thought}</div>`
                ).join('');
            }
        }

        function showDecisionPanel() {
            document.getElementById('decisionPanel').style.display = 'block';
            
            // Update decision description based on role
            const descriptions = {
                emperor: "Ë∫´ÁÇ∫Â§©ÁöáÔºåÊÇ®ÊìÅÊúâËá≥È´òÁÑ°‰∏äÁöÑÈÅìÂæ∑Â®ÅÊúõ„ÄÇÊÇ®ÁöÑÊ±∫ÂÆöÂ∞áÂΩ±ÈüøÂ∏ùÂúãÁöÑÊú™‰æÜÊñπÂêë„ÄÇË´ãÊÖéÈáçËÄÉÊÖÆÂ¶Ç‰ΩïÈÅãÁî®ÊÇ®ÁöÑÊ¨äÂ®Å‰æÜÁ∂≠Ë≠∑ÂíåÂπ≥„ÄÇ",
                chiang: "‰ΩúÁÇ∫‰∏≠ËèØÊ∞ëÂúãÁöÑÈ†òË¢ñÔºåÊÇ®ÂøÖÈ†àÂú®Á∂≠Ë≠∑ÂúãÂÆ∂‰∏ªÊ¨äËàáÈÅøÂÖç‰∫∫Ê∞ëÂèóÊà∞Áà≠‰πãËã¶ÈñìÂèñÂæóÂπ≥Ë°°„ÄÇÊÇ®ÁöÑÊ±∫Á≠ñÈóú‰øÇ‰∏≠ËèØÊ∞ëÊóèÁöÑÂ≠ò‰∫°„ÄÇ"
            };
            
            document.getElementById('decisionDescription').textContent = descriptions[gameState.selectedRole];
        }

        function submitDecision() {
            const decision = gameState.currentDecision;
            const input = document.getElementById('decisionInput').value.trim();
            
            if (!decision) {
                alert('Ë´ãÈÅ∏Êìá‰∏ÄÂÄãË°åÂãïÊñπÈáùÔºÅ');
                return;
            }
            
            if (!input) {
                alert('Ë´ãË©≥Á¥∞Ë™™ÊòéÊÇ®ÁöÑÊ±∫Á≠ñÁêÜÁî±ÔºÅ');
                return;
            }

            // Hide decision panel and show loading
            document.getElementById('decisionPanel').style.display = 'none';
            showLoading(true);

            // Process decision (simulate AI response)
            setTimeout(() => {
                processDecision(decision, input);
                showLoading(false);
                
                // Check if simulation should continue
                if (gameState.currentTurn < gameState.maxTurns && !checkEndConditions()) {
                    setTimeout(() => {
                        startNewTurn();
                    }, 2000);
                } else {
                    endSimulation();
                }
            }, 4000);
        }

        function processDecision(decision, reasoning) {
            // Simulate decision impact on metrics
            const impacts = {
                diplomatic: { peace: 15, diplomacy: 20, reputation: 10, stability: 5 },
                restraint: { peace: 20, diplomacy: 10, reputation: 15, stability: 10 },
                mediation: { peace: 10, diplomacy: 25, reputation: 20, stability: 5 },
                unity: { peace: 5, diplomacy: 15, reputation: 5, stability: 25 },
                concession: { peace: 25, diplomacy: 15, reputation: -5, stability: -10 },
                appeal: { peace: 10, diplomacy: 20, reputation: 15, stability: 0 }
            };

            const impact = impacts[decision] || { peace: 0, diplomacy: 0, reputation: 0, stability: 0 };
            
            // Apply random variation
            Object.keys(impact).forEach(key => {
                impact[key] += Math.random() * 10 - 5; // ¬±5 random variation
            });

            // Update metrics
            gameState.metrics.peace = Math.max(0, Math.min(100, gameState.metrics.peace + impact.peace));
            gameState.metrics.diplomacy = Math.max(0, gameState.metrics.diplomacy + impact.diplomacy);
            gameState.metrics.reputation = Math.max(0, Math.min(100, gameState.metrics.reputation + impact.reputation));
            gameState.metrics.stability = Math.max(0, Math.min(100, gameState.metrics.stability + impact.stability));

            // Update UI
            updateMetrics();

            // Add decision to events
            const decisionNames = {
                diplomatic: 'Â§ñ‰∫§ÂÄ°Ë≠∞',
                restraint: 'Ëªç‰∫ãÂÖãÂà∂', 
                mediation: 'ÂúãÈöõË™øËß£',
                unity: 'ÂÖßÈÉ®ÂúòÁµê',
                concession: 'Á≠ñÁï•ËÆìÊ≠•',
                appeal: 'ÂÖ¨ÈñãÂëºÁ±≤'
            };

            addEvent(`${decisionNames[decision]}`, `Ê±∫Á≠ñÂü∑Ë°å: ${reasoning.substring(0, 100)}...`);

            // Generate AI responses
            generateAIResponses(decision);

            // Clear decision input
            gameState.currentDecision = null;
            document.getElementById('decisionInput').value = '';
            document.querySelectorAll('.decision-option').forEach(opt => {
                opt.classList.remove('selected');
            });
        }

        function generateAIResponses(playerDecision) {
            const responses = {
                emperor: {
                    diplomatic: "‰∏≠ÂúãÊñπÈù¢Â∞çÂ§©ÁöáÁöÑÂíåÂπ≥ÂÄ°Ë≠∞Ë°®Á§∫Ë¨πÊÖéÊ≠ìËøéÔºå‰ΩÜË¶ÅÊ±ÇÂÖ∑È´î‰øùË≠â„ÄÇËªçÈÉ®Â∞çÊ≠§Ê±∫ÂÆöË°®ÈÅî‰∏çÊªø„ÄÇ",
                    restraint: "ËªçÈÉ®ÂãâÂº∑Êé•ÂèóÂ§©ÁöáÁöÑÂÖãÂà∂‰ª§Ôºå‰ΩÜË≠¶ÂëäÈåØÂ§±Êà∞Áï•Ê©üÊúÉ„ÄÇ‰∏≠ÂúãÊñπÈù¢ÈáãÂá∫Á©çÊ•µ‰ø°Ëôü„ÄÇ",
                    mediation: "ÂúãÈöõÁ§æÊúÉËÆöÊèöÂ§©ÁöáÁöÑÊô∫ÊÖßÊ±∫ÂÆöÔºåÁæéËã±Ë°®Á§∫È°òÊÑèÂçîÂä©Ë™øÂÅú„ÄÇ"
                },
                chiang: {
                    diplomatic: "Êó•Êú¨ËªçÈÉ®Â∞çË´áÂà§ÊèêË≠∞ÂèçÊáâÂÜ∑Ê∑°Ôºå‰ΩÜÂ§©ÁöáÂèäÊ∫´ÂíåÊ¥æË°®Á§∫ÂèØ‰ª•ËÄÉÊÖÆ„ÄÇ",
                    restraint: "‰∏≠ÂúãËªçÈöäÁöÑÂÖãÂà∂ÂßøÊÖãÁç≤ÂæóÂúãÈöõËÆöÊèöÔºå‰ΩÜÂúãÂÖßÊøÄÈÄ≤Ê¥æÊâπË©ïÈÅéÊñºËªüÂº±„ÄÇ",
                    mediation: "ÂúãÈöõË™øÂÅúÁç≤ÂæóÊîØÊåÅÔºå‰ΩÜÊó•Êú¨ËªçÈÉ®Ë≥™ÁñëÁ¨¨‰∏âÊñπÂπ≤È†êÁöÑÂêàÊ≥ïÊÄß„ÄÇ"
                }
            };

            const roleResponses = responses[gameState.selectedRole] || {};
            const response = roleResponses[playerDecision] || "ÂêÑÊñπÂ∞çÊÇ®ÁöÑÊ±∫ÂÆöÂèçÊáâ‰∏ç‰∏ÄÔºåÂ±ÄÂã¢ÁôºÂ±ï‰ªçÂæÖËßÄÂØü„ÄÇ";
            
            addEvent("ÂêÑÊñπÂõûÊáâ", response);
        }

        function updateMetrics() {
            document.getElementById('peaceScore').textContent = Math.round(gameState.metrics.peace);
            document.getElementById('diplomacyScore').textContent = Math.round(gameState.metrics.diplomacy);
            document.getElementById('reputationScore').textContent = Math.round(gameState.metrics.reputation);
            document.getElementById('stabilityScore').textContent = Math.round(gameState.metrics.stability);

            document.getElementById('peaceProgress').style.width = gameState.metrics.peace + '%';
            document.getElementById('diplomacyProgress').style.width = Math.min(100, gameState.metrics.diplomacy) + '%';
            document.getElementById('reputationProgress').style.width = gameState.metrics.reputation + '%';
            document.getElementById('stabilityProgress').style.width = gameState.metrics.stability + '%';

            // Update progress bar colors based on values
            const peaceColor = gameState.metrics.peace > 70 ? '#28a745' : gameState.metrics.peace > 40 ? '#ffc107' : '#dc3545';
            document.getElementById('peaceProgress').style.background = `linear-gradient(45deg, ${peaceColor}, ${peaceColor}dd)`;
        }

        function addEvent(title, description) {
            const eventsList = document.getElementById('eventsList');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.innerHTML = `
                <div class="event-time">Á¨¨${gameState.currentTurn}ÂõûÂêà - ${title}</div>
                <div>${description}</div>
            `;
            eventsList.appendChild(eventItem);
            eventsList.scrollTop = eventsList.scrollHeight;
        }

        function showLoading(show) {
            document.getElementById('loadingState').style.display = show ? 'block' : 'none';
        }

        function checkEndConditions() {
            // Peace achieved
            if (gameState.metrics.peace >= 80 && gameState.metrics.diplomacy >= 50) {
                return 'peace_achieved';
            }
            
            // Peace failed
            if (gameState.metrics.peace <= 20) {
                return 'peace_failed';
            }
            
            return false;
        }

        function endSimulation() {
            const endCondition = checkEndConditions();
            let finalMessage = '';
            let resultClass = '';

            if (endCondition === 'peace_achieved') {
                finalMessage = 'üéâ ÊÅ≠ÂñúÔºÅÊÇ®ÊàêÂäüÈòªÊ≠¢‰∫ÜÊà∞Áà≠ÁöÑÁàÜÁôºÔºåÂØ¶Áèæ‰∫ÜÂíåÂπ≥ÔºÅÊÇ®ÁöÑÂ§ñ‰∫§Êô∫ÊÖßÊãØÊïë‰∫ÜÁÑ°Êï∏ÁîüÂëΩ„ÄÇ';
                resultClass = 'success';
            } else if (endCondition === 'peace_failed') {
                finalMessage = 'üòî ÂæàÈÅ∫ÊÜæÔºåÂ§ñ‰∫§Âä™ÂäõÂ§±ÊïóÔºåÊà∞Áà≠‰∏çÂèØÈÅøÂÖç„ÄÇ‰ΩÜÊÇ®ÁöÑÂòóË©¶‰ªçÊúâÊÑèÁæ©ÔºåÂíåÂπ≥‰πãË∑ØÂæû‰æÜ‰∏çÊòì„ÄÇ';
                resultClass = 'failure';
            } else if (gameState.metrics.peace >= 60) {
                finalMessage = 'ü§ù ÊÇ®ÈÅîÊàê‰∫ÜÈÉ®ÂàÜÂíåÂπ≥ÁõÆÊ®ô„ÄÇÈõñÊú™ÂÆåÂÖ®ÈòªÊ≠¢Ë°ùÁ™ÅÔºå‰ΩÜÈ°ØËëóÈôç‰Ωé‰∫ÜÊà∞Áà≠Ë¶èÊ®°„ÄÇ';
                resultClass = 'partial';
            } else {
                finalMessage = '‚öñÔ∏è Â±ÄÂã¢Ë§áÈõúÔºåÁµêÊûúÂñúÊÜÇÂèÉÂçä„ÄÇÊ≠∑Âè≤Ë≠âÊòéÔºåÂíåÂπ≥ÈúÄË¶ÅÂêÑÊñπÁöÑÂÖ±ÂêåÂä™Âäõ„ÄÇ';
                resultClass = 'mixed';
            }

            // Display final results
            const resultPanel = document.createElement('div');
            resultPanel.className = `situation-panel ${resultClass}`;
            resultPanel.innerHTML = `
                <div class="situation-title">
                    üèÜ Ê®°Êì¨ÁµêÊûú
                </div>
                <div style="font-size: 1.2rem; margin-bottom: 20px;">${finalMessage}</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                    <div>ÊúÄÁµÇÂíåÂπ≥ÂàÜÊï∏: <strong>${Math.round(gameState.metrics.peace)}/100</strong></div>
                    <div>Â§ñ‰∫§ÊàêÂäüÂ∫¶: <strong>${Math.round(gameState.metrics.diplomacy)}</strong></div>
                    <div>ÂúãÈöõËÅ≤Êúõ: <strong>${Math.round(gameState.metrics.reputation)}/100</strong></div>
                    <div>ÂÖßÈÉ®Á©©ÂÆö: <strong>${Math.round(gameState.metrics.stability)}/100</strong></div>
                </div>
                <div style="margin-top: 20px;">
                    <button onclick="location.reload()" style="padding: 10px 30px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                        üîÑ ÈáçÊñ∞ÈñãÂßãÊ®°Êì¨
                    </button>
                    <button onclick="downloadResults()" style="padding: 10px 30px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">
                        üíæ ‰∏ãËºâÁµêÊûúÂ†±Âëä
                    </button>
                </div>
            `;
            
            document.getElementById('situationPanel').replaceWith(resultPanel);
        }

        function downloadResults() {
            const results = {
                role: gameState.selectedRole,
                mode: gameState.selectedMode,
                turns: gameState.currentTurn,
                finalMetrics: gameState.metrics,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `peace_simulation_results_${Date.now()}.json`;
            link.click();
        }
    </script>
</body>
</html>peaceScore">100</div>
                    <div class="metric-label">ÂíåÂπ≥ÂàÜÊï∏</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="peaceProgress" style="width: 100%"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="diplomacyScore">0</div>
                    <div class="metric-label">Â§ñ‰∫§ÊàêÂäü</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="diplomacyProgress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="
